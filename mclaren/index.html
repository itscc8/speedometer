<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>720S Track Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #050505;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            color: #e5e7eb;
        }

        /* Main Dashboard Container */
        .dashboard-container {
            position: relative;
            width: 800px;
            height: 450px;
            background: radial-gradient(circle at center bottom, #1a1a1a 0%, #000000 80%);
            border-radius: 20px;
            border: 1px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align items to top */
            padding-top: 60px;
        }

        @media (max-width: 820px) {
            .dashboard-container {
                transform: scale(0.6);
                width: 100%;
            }
        }

        /* --- Shift Lights (F1 Style) --- */
        .shift-lights-bar {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            height: 12px;
            width: 60%;
            justify-content: center;
            opacity: 0.8;
        }

        .led {
            flex: 1;
            height: 100%;
            background: #333;
            border-radius: 2px;
            transform: skewX(-20deg); /* Sporty slant */
        }

        /* LED Active States */
        .led.green.on { background: #22c55e; box-shadow: 0 0 15px #22c55e; }
        .led.red.on { background: #ef4444; box-shadow: 0 0 15px #ef4444; }
        .led.blue.on { background: #3b82f6; box-shadow: 0 0 15px #3b82f6; }

        /* --- Main Gauge Cluster --- */
        .gauge-cluster {
            position: relative;
            width: 500px;
            height: 250px; /* Half height for semicircle look */
            margin-top: 20px;
        }

        .tach-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        /* Background Track */
        .ring-bg {
            fill: none;
            stroke: #1f2937; /* Dark Gray */
            stroke-width: 40; /* Thick bar */
            stroke-linecap: butt; /* Flat ends */
        }

        /* Active RPM Ring */
        .ring-fill {
            fill: none;
            stroke: #f97316; /* McLaren Orange */
            stroke-width: 40;
            stroke-linecap: butt;
            transition: stroke-dashoffset 0.05s linear; /* Smooth fill */
            filter: drop-shadow(0 0 15px rgba(249, 115, 22, 0.5));
        }
        
        .ring-fill.limit {
            stroke: #ef4444; /* Redline */
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.8));
        }

        /* --- Center Data --- */
        .center-data {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            justify-content: flex-end; /* Push content to bottom */
        }

        /* Gear Number */
        .gear-display {
            font-size: 9rem;
            font-weight: 900;
            color: #fff;
            line-height: 0.8;
            text-shadow: 0 0 30px rgba(255,255,255,0.1);
            margin-bottom: 10px;
            z-index: 20;
        }
        
        .gear-label {
            font-size: 1rem;
            color: #6b7280;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        /* Speed - Positioned Bottom Right relative to Gear */
        .speed-container {
            position: absolute;
            right: 40px; /* Push to right side of the arc gap */
            bottom: 10px;
            text-align: right;
        }

        .speed-display {
            font-family: 'Rajdhani', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: #fff;
            line-height: 1;
            display: block;
        }
        
        .unit-label {
            font-size: 1rem;
            color: #9ca3af;
            font-weight: 500;
        }

        /* RPM Text - Bottom Left */
        .rpm-container {
            position: absolute;
            left: 40px;
            bottom: 20px;
            text-align: left;
        }
        .rpm-val {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            color: #9ca3af;
        }

        /* Mode Indicator */
        .mode-badge {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.5);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            letter-spacing: 2px;
            font-weight: bold;
        }

        /* Controls Overlay */
        .controls-overlay {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        .controls-overlay:hover { opacity: 1; }

        .control-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
        }
        .control-btn:active { background: #f97316; color: #000; }

    </style>
</head>
<body>

    <div class="dashboard-container">
        
        <div class="mode-badge">TRACK</div>

        <div class="shift-lights-bar" id="shiftLights">
            <div class="led green"></div><div class="led green"></div><div class="led green"></div>
            <div class="led red"></div><div class="led red"></div><div class="led red"></div>
            <div class="led blue"></div><div class="led blue"></div><div class="led blue"></div>
        </div>

        <div class="gauge-cluster">
            <svg class="tach-svg" viewBox="0 0 500 250">
                <path class="ring-bg" id="ringBg" d="" />
                <path class="ring-fill" id="ringFill" d="" />
            </svg>

            <div class="center-data">
                <div class="gear-label">GEAR</div>
                <div class="gear-display" id="gearVal">N</div>
            </div>

            <div class="speed-container">
                <span class="speed-display" id="speedVal">0</span>
                <span class="unit-label">KMH</span>
            </div>

            <div class="rpm-container">
                <span class="rpm-val" id="rpmText">0</span>
                <div class="unit-label" style="font-size:0.7rem">RPM</div>
            </div>
        </div>

        <div class="controls-overlay">
            <button class="control-btn" id="shiftDown">Shift -</button>
            <button class="control-btn" id="accelBtn">Gas (Space)</button>
            <button class="control-btn" id="shiftUp">Shift +</button>
        </div>

    </div>

    <script>
        // --- Configuration ---
        const REV_LIMIT = 5000; 
        const IDLE_RPM = 800;
        const MAX_GEAR = 5;

        // Gear Ratios (Top Speed at 5000 RPM)
        const GEAR_MAX_SPEEDS = {
            1: 30, 2: 55, 3: 80, 4: 100, 5: 120
        };

        // SVG Config
        const CX = 250;
        const CY = 210; 
        // CHANGED: Renamed variable 'R' to 'GAUGE_RADIUS' to prevent scope conflict
        const GAUGE_RADIUS = 190;
        
        // Define Path using the new variable name
        const pathD = `M ${CX - GAUGE_RADIUS} ${CY} A ${GAUGE_RADIUS} ${GAUGE_RADIUS} 0 1 1 ${CX + GAUGE_RADIUS} ${CY}`;
        
        const ringBg = document.getElementById('ringBg');
        const ringFill = document.getElementById('ringFill');
        
        ringBg.setAttribute('d', pathD);
        ringFill.setAttribute('d', pathD);

        // Calculate Length for Animation
        const pathLength = ringBg.getTotalLength();
        ringFill.style.strokeDasharray = pathLength;
        ringFill.style.strokeDashoffset = pathLength; // Start hidden

        // --- Logic ---
        let state = {
            rpm: 0,
            speed: 0,
            gear: 1,
            gas: false
        };

        const shiftLights = document.querySelectorAll('.led');
        const gearVal = document.getElementById('gearVal');
        const speedVal = document.getElementById('speedVal');
        const rpmText = document.getElementById('rpmText');

        function updatePhysics() {
            // RPM
            if (state.gas) state.rpm += 120;
            else state.rpm -= 80;

            // Clamp
            if (state.rpm < IDLE_RPM) state.rpm = IDLE_RPM;
            if (state.rpm > REV_LIMIT) state.rpm = REV_LIMIT;

            // Speed
            const gearMax = GEAR_MAX_SPEEDS[state.gear];
            state.speed = (state.rpm / REV_LIMIT) * gearMax;

            // --- Render ---
            
            // 1. Ring Animation (Left to Right)
            // Current RPM ratio
            const ratio = (state.rpm) / REV_LIMIT; // 0 to 1
            ringFill.style.strokeDashoffset = pathLength * (1 - ratio);

            // Color Logic (Orange -> Red at limit)
            if (state.rpm > REV_LIMIT - 300) {
                ringFill.classList.add('limit');
            } else {
                ringFill.classList.remove('limit');
            }

            // 2. Text
            gearVal.textContent = state.gear;
            speedVal.textContent = Math.floor(state.speed);
            rpmText.textContent = Math.round(state.rpm);

            // 3. Lights
            updateLights(state.rpm);

            requestAnimationFrame(updatePhysics);
        }

        function updateLights(rpm) {
            const count = shiftLights.length;
            // Lights start at 3000 RPM
            const startRPM = 3000;
            const range = REV_LIMIT - startRPM;
            
            if (rpm < startRPM) {
                shiftLights.forEach(l => l.classList.remove('on'));
                return;
            }

            const progress = (rpm - startRPM) / range; // 0 to 1
            const activeCount = Math.ceil(progress * count);

            shiftLights.forEach((led, idx) => {
                if (idx < activeCount) led.classList.add('on');
                else led.classList.remove('on');
            });
        }

        // --- Inputs ---
        function shift(dir) {
            const newGear = state.gear + dir;
            if (newGear < 1 || newGear > MAX_GEAR) return;
            
            // RPM match
            const oldMax = GEAR_MAX_SPEEDS[state.gear];
            const newMax = GEAR_MAX_SPEEDS[newGear];
            state.gear = newGear;
            state.rpm = state.rpm * (oldMax / newMax);

            // Animation
            gearVal.style.transform = "scale(0.8)";
            setTimeout(() => gearVal.style.transform = "scale(1)", 100);
        }

        const setGas = (v) => {
            state.gas = v;
            const btn = document.getElementById('accelBtn');
            if(v) btn.style.background = "#f97316";
            else btn.style.background = "rgba(255,255,255,0.05)";
        };

        // Listeners
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') setGas(true);
            if (e.code === 'ArrowUp') shift(1);
            if (e.code === 'ArrowDown') shift(-1);
        });
        document.addEventListener('keyup', (e) => {
            if (e.code === 'Space') setGas(false);
        });

        const bindBtn = (id, start, end) => {
            const el = document.getElementById(id);
            el.addEventListener('mousedown', start);
            el.addEventListener('mouseup', end);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); start(); });
            el.addEventListener('touchend', (e) => { e.preventDefault(); end(); });
        };

        bindBtn('accelBtn', () => setGas(true), () => setGas(false));
        bindBtn('shiftUp', () => shift(1), () => {});
        bindBtn('shiftDown', () => shift(-1), () => {});

        requestAnimationFrame(updatePhysics);

    </script>
</body>
</html>